@prefix ex: <http://example.org/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

ex:Calculation_Inst rdf:type ex:Calculation;
  ex:hasArg ex:WeightInstance.

ex:WeightInstance rdf:type ex:Weight;
  ex:hasValue "5"^^xsd:integer.

ex:CalculationShape a sh:NodeShape ;
  sh:targetClass ex:Calculation ;
  sh:rule [
   a sh:SPARQLRule ;
   sh:construct """
     prefix ex: <http://example.org/> 
     prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
     CONSTRUCT {
       ?this ex:hasOutput ?outputInstance .
       ?outputInstance rdf:type ex:Weight ;
                       ex:hasValue ?outputValue .
     }
     WHERE {
       ?this ex:hasArg ?weightInstance .
       ?weightInstance rdf:type ex:Weight ;
                       ex:hasValue ?weightValue .
       BIND (?weightValue * 2 AS ?outputValue)
       BIND (iri(concat(str(?this), "_output")) AS ?outputInstance)
     }
   """
  ] .